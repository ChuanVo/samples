format_version: "8"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

app:


workflows:
  test:
    envs:
    - CLONE_INTO_DIR: "./test"
    - GIT_REPOSITORY_URL: https://github.com/ChuanVo/samples.git
    before_run:
    - _test_too_long_commit_message
    after_run:
    - run_test

  run_test: 
    envs: 
        - SOURCE_JAVASCRIPT_TEST: ./test/javascript
    steps:
    - change-workdir:
        title: Change directory to a temporary directory
        is_always_run: true
        inputs:
        - path: $SOURCE_JAVASCRIPT_TEST
    - script@1.1.3: 
        inputs:
        - content: |
            #!/bin/bash
            set -ex
            echo "$BITRISE_SOURCE_DIR"
            npm install
            npm run android-app-test

  _test_too_long_commit_message:
    before_run:
      - _create_tmpdir
    steps:
      - git-clone:
          run_if: true
          inputs:
            - clone_into_dir: $CLONE_INTO_DIR
            - branch: "test-bitrise"

      - ensure-clean-git:
          inputs:
            - dir_to_check: $CLONE_INTO_DIR

  _create_tmpdir:
    steps:
    - script:
        inputs:
        - content: envman add --key STEP_TMPDIR --value $(mktemp -d -t step-git-clone)
    - change-workdir:
        title: Change directory to a temporary directory
        is_always_run: true
        inputs:
        - path: $STEP_TMPDIR

